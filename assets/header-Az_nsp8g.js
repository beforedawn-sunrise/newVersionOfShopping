import{c as m,o as p,a as e,d as L,r as d,F as $,b as w,u,e as I,t as U,w as b,v as C,f as B,g as k,_ as M,h as N,i as V,j as _,n as Z}from"./index-QOAwnqUP.js";import{L as T}from"./index-9PV-dxnx.js";import{u as D}from"./signInStore-CPb0EWa0.js";import{u as E}from"./frontStage-JE2TTqpW.js";import{C as O}from"./connect-DGni7-7n.js";import{o as G,c as J}from"./indexedDB-C2533RPs.js";import{r as P}from"./Bars3Icon-DFHF5Rj5.js";import{r as j}from"./HeartIcon-BPETxBlB.js";function F(i,t){return p(),m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z","clip-rule":"evenodd"})])}function H(i,t){return p(),m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M7.5 6v.75H5.513c-.96 0-1.764.724-1.865 1.679l-1.263 12A1.875 1.875 0 0 0 4.25 22.5h15.5a1.875 1.875 0 0 0 1.865-2.071l-1.263-12a1.875 1.875 0 0 0-1.865-1.679H16.5V6a4.5 4.5 0 1 0-9 0ZM12 3a3 3 0 0 0-3 3v.75h6V6a3 3 0 0 0-3-3Zm-3 8.25a3 3 0 1 0 6 0v-.75a.75.75 0 0 1 1.5 0v.75a4.5 4.5 0 1 1-9 0v-.75a.75.75 0 0 1 1.5 0v.75Z","clip-rule":"evenodd"})])}function z(i,t){return p(),m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M18.685 19.097A9.723 9.723 0 0 0 21.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 0 0 3.065 7.097A9.716 9.716 0 0 0 12 21.75a9.716 9.716 0 0 0 6.685-2.653Zm-12.54-1.285A7.486 7.486 0 0 1 12 15a7.486 7.486 0 0 1 5.855 2.812A8.224 8.224 0 0 1 12 20.25a8.224 8.224 0 0 1-5.855-2.438ZM15.75 9a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z","clip-rule":"evenodd"})])}class x extends Error{}x.prototype.name="InvalidTokenError";function R(i){return decodeURIComponent(atob(i).replace(/(.)/g,(t,l)=>{let s=l.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}function W(i){let t=i.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return R(t)}catch{return atob(t)}}function q(i,t){if(typeof i!="string")throw new x("Invalid token specified: must be a string");t||(t={});const l=t.header===!0?0:1,s=i.split(".")[l];if(typeof s!="string")throw new x(`Invalid token specified: missing part #${l+1}`);let r;try{r=W(s)}catch(c){throw new x(`Invalid token specified: invalid base64 for part #${l+1} (${c.message})`)}try{return JSON.parse(r)}catch(c){throw new x(`Invalid token specified: invalid json for part #${l+1} (${c.message})`)}}const K={class:"login-container"},Q={class:"login-card"},X={key:0,class:"hint"},Y={class:"input-container"},ee={class:"input-container"},te={class:"input-container"},ne=L({__name:"signInModal",setup(i){const t=D(),l=E(),s=d({username:"",password:""}),r=d(!1),c=d(""),S=async()=>{r.value=!0,await O("POST","https://vue-course-api.hexschool.io/admin/signin",s.value).then(a=>{a.data.success?(t.isLogin=!0,r.value=!1,sessionStorage.setItem("userToken",JSON.stringify(a.data.token)),k.push("/backStage/products")):(r.value=!1,c.value=a.data.message)})},y=async a=>{if(a.credential){const n=q(a.credential);console.log(n),t.googleInfo={name:n.name,picture:n.picture,email:n.email,tel:"",address:""},t.isLogin=!0,sessionStorage.setItem("sessionIsLogin",JSON.stringify(!0)),sessionStorage.setItem("sessionGoogleInfo",JSON.stringify(t.googleInfo)),window.dispatchEvent(new Event("sessionUpdated"));let h;await G("orderDB",2).then(async v=>{h=v;const g=await J(h,"orders");l.myPiniaOrder.push(...g)}),location.reload()}};return(a,n)=>{const h=B("GoogleLogin");return p(),m($,null,[w(u(T),{active:r.value,"onUpdate:active":n[0]||(n[0]=v=>r.value=v),"can-cancel":!0,"is-full-page":!0},null,8,["active"]),e("div",K,[e("div",Q,[c.value!=""?(p(),m("div",X,U(c.value),1)):I("",!0),e("div",Y,[n[3]||(n[3]=e("p",{class:"login-text"},"帳號:",-1)),b(e("input",{type:"text","onUpdate:modelValue":n[1]||(n[1]=v=>s.value.username=v)},null,512),[[C,s.value.username]])]),e("div",ee,[n[4]||(n[4]=e("p",{class:"login-text"},"密碼:",-1)),b(e("input",{type:"password","onUpdate:modelValue":n[2]||(n[2]=v=>s.value.password=v)},null,512),[[C,s.value.password]])]),e("div",{class:"input-container"},[e("button",{type:"button",class:"loginBtn",onClick:S},"登入")]),n[5]||(n[5]=e("hr",null,null,-1)),n[6]||(n[6]=e("div",{class:"input-container"},[e("p",{class:"hint-text"},"一般訪客請用google登入")],-1)),e("div",te,[w(h,{callback:y})])])])],64)}}}),oe=M(ne,[["__scopeId","data-v-f5385bb5"]]),se=["src"],ae={key:1,class:"personal-container"},le=L({__name:"header",setup(i){const t=E();d(!1),D();const l=d(!1),s=d(!1),r=d(""),c=d(!1),S=async()=>{c.value=!0,await O("GET","https://vue-course-api.hexschool.io/api/lucy104/products/all","").then(g=>{if(console.log("取得產品"),console.log(g.data),g.data.success){c.value=!1,t.productList=g.data.products;for(let o of t.productList)o.isInWishList=!1}})},y=d(!1),a=d({name:"",picture:"",email:"",tel:"",address:""});function n(){sessionStorage.getItem("sessionIsLogin")!==null&&(console.log("a"),y.value=!0);const o=sessionStorage.getItem("sessionGoogleInfo");o!==null&&(console.log("b"),a.value=JSON.parse(o))}N(async()=>{n(),window.addEventListener("sessionUpdated",n),await S()}),V(()=>{window.removeEventListener("sessionUpdated",n)});const h=()=>{y.value=!1,a.value={name:"",picture:"",email:"",tel:"",address:""},sessionStorage.clear(),localStorage.clear(),t.myPiniaOrder=[]},v=()=>{s.value=!1,t.productList=t.productList.filter(g=>g.title.includes(r.value))};return(g,o)=>{const A=B("router-view");return p(),m($,null,[y.value==!1?(p(),_(oe,{key:0})):I("",!0),e("nav",null,[w(u(P),{class:"icon hamburger",onClick:o[0]||(o[0]=f=>s.value=!s.value)}),e("p",{class:"md-title",onClick:o[1]||(o[1]=f=>u(k).push("/"))},"雲購物"),e("ul",{class:Z(["hamburger-menu",{"menu-flex":s.value}])},[e("li",null,[e("p",{class:"pc-title",onClick:o[2]||(o[2]=f=>u(k).push("/"))},"雲購物")]),e("li",null,[b(e("input",{type:"text","onUpdate:modelValue":o[3]||(o[3]=f=>r.value=f)},null,512),[[C,r.value]]),e("button",{type:"button",class:"searchBtn",onClick:v},[w(u(F),{style:{color:"white",width:"20px",height:"20px"}})])])],2),e("ul",null,[e("li",null,[w(u(j),{class:"icon",onClick:o[4]||(o[4]=f=>u(k).push("/wishlist"))})]),e("li",null,[w(u(H),{class:"icon",onClick:o[5]||(o[5]=f=>u(k).push("/cart"))})]),e("li",null,[a.value.picture!==""?(p(),m("img",{key:0,src:a.value.picture,class:"google-picture",alt:"",onClick:o[6]||(o[6]=f=>l.value=!l.value)},null,8,se)):I("",!0),a.value.picture===""?(p(),_(u(z),{key:1,class:"icon"})):I("",!0)])])]),l.value?(p(),m("div",ae,[e("p",null,U(a.value.name)+",您好",1),e("p",{onClick:o[7]||(o[7]=f=>u(k).push("/myOrder"))},"我的訂單"),e("p",{onClick:h},"登出")])):I("",!0),w(A)],64)}}}),fe=M(le,[["__scopeId","data-v-88048ab0"]]);export{fe as default};
