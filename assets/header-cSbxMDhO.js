import{c as f,o as d,a as e,d as $,r as c,F as U,b as k,u as v,e as y,t as B,w as b,v as C,f as M,g as I,_ as O,h as Z,i as T,j as _,n as G}from"./index-BD2cTxBF.js";import{L as P}from"./index-DfgLizOp.js";import{u as D}from"./signInStore-Be7Xrlf9.js";import{u as E}from"./frontStage-C8x3WYE_.js";import{C as A}from"./connect-DGni7-7n.js";import{o as J,c as j}from"./indexedDB-C2533RPs.js";import{r as F}from"./Bars3Icon-BuDGOEyW.js";import{r as H}from"./HeartIcon-B9uxzEJA.js";function z(i,t){return d(),f("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z","clip-rule":"evenodd"})])}function R(i,t){return d(),f("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M7.5 6v.75H5.513c-.96 0-1.764.724-1.865 1.679l-1.263 12A1.875 1.875 0 0 0 4.25 22.5h15.5a1.875 1.875 0 0 0 1.865-2.071l-1.263-12a1.875 1.875 0 0 0-1.865-1.679H16.5V6a4.5 4.5 0 1 0-9 0ZM12 3a3 3 0 0 0-3 3v.75h6V6a3 3 0 0 0-3-3Zm-3 8.25a3 3 0 1 0 6 0v-.75a.75.75 0 0 1 1.5 0v.75a4.5 4.5 0 1 1-9 0v-.75a.75.75 0 0 1 1.5 0v.75Z","clip-rule":"evenodd"})])}function W(i,t){return d(),f("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M18.685 19.097A9.723 9.723 0 0 0 21.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 0 0 3.065 7.097A9.716 9.716 0 0 0 12 21.75a9.716 9.716 0 0 0 6.685-2.653Zm-12.54-1.285A7.486 7.486 0 0 1 12 15a7.486 7.486 0 0 1 5.855 2.812A8.224 8.224 0 0 1 12 20.25a8.224 8.224 0 0 1-5.855-2.438ZM15.75 9a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z","clip-rule":"evenodd"})])}class x extends Error{}x.prototype.name="InvalidTokenError";function q(i){return decodeURIComponent(atob(i).replace(/(.)/g,(t,a)=>{let s=a.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}function K(i){let t=i.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return q(t)}catch{return atob(t)}}function Q(i,t){if(typeof i!="string")throw new x("Invalid token specified: must be a string");t||(t={});const a=t.header===!0?0:1,s=i.split(".")[a];if(typeof s!="string")throw new x(`Invalid token specified: missing part #${a+1}`);let l;try{l=K(s)}catch(p){throw new x(`Invalid token specified: invalid base64 for part #${a+1} (${p.message})`)}try{return JSON.parse(l)}catch(p){throw new x(`Invalid token specified: invalid json for part #${a+1} (${p.message})`)}}const X={class:"login-container"},Y={class:"login-card"},ee={key:0,class:"hint"},te={class:"input-container"},se={class:"input-container"},oe={class:"input-container"},ne=$({__name:"signInModal",setup(i){const t=D(),a=E(),s=c({username:"",password:""}),l=c(!1),p=c(""),h=async()=>{l.value=!0,await A("POST","https://vue-course-api.hexschool.io/admin/signin",s.value).then(g=>{g.data.success?(t.isLogin=!0,l.value=!1,sessionStorage.setItem("userToken",JSON.stringify(g.data.token)),I.push("/backStage/products")):(l.value=!1,p.value=g.data.message)})},S=async g=>{if(g.credential){const o=Q(g.credential);console.log(o),t.googleInfo={name:o.name,picture:o.picture,email:o.email,tel:"",address:""},t.isLogin=!0,sessionStorage.setItem("sessionIsLogin",JSON.stringify(!0)),sessionStorage.setItem("sessionGoogleInfo",JSON.stringify(t.googleInfo)),window.dispatchEvent(new Event("sessionUpdated"));let r;await J("orderDB",2).then(async u=>{r=u;const L=await j(r,"orders");a.myPiniaOrder.push(...L)}),location.reload()}};return(g,o)=>{const r=M("GoogleLogin");return d(),f(U,null,[k(v(P),{active:l.value,"onUpdate:active":o[0]||(o[0]=u=>l.value=u),"can-cancel":!0,"is-full-page":!0},null,8,["active"]),e("div",X,[e("div",Y,[p.value!=""?(d(),f("div",ee,B(p.value),1)):y("",!0),e("div",te,[o[3]||(o[3]=e("p",{class:"login-text"},"帳號:",-1)),b(e("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=u=>s.value.username=u)},null,512),[[C,s.value.username]])]),e("div",se,[o[4]||(o[4]=e("p",{class:"login-text"},"密碼:",-1)),b(e("input",{type:"password","onUpdate:modelValue":o[2]||(o[2]=u=>s.value.password=u)},null,512),[[C,s.value.password]])]),e("div",{class:"input-container"},[e("button",{type:"button",class:"loginBtn",onClick:h},"登入")]),o[5]||(o[5]=e("hr",null,null,-1)),o[6]||(o[6]=e("div",{class:"input-container"},[e("p",{class:"hint-text"},"一般訪客請用google登入")],-1)),e("div",oe,[k(r,{callback:S})])])])],64)}}}),ae=O(ne,[["__scopeId","data-v-566ee29d"]]),le=["src"],ie={key:1,class:"personal-container"},re=$({__name:"header",setup(i){const t=E();c(!1),D();const a=c(!1),s=c(!1),l=c(""),p=c(!1),h=c([]),S=async()=>{p.value=!0,await A("GET","https://vue-course-api.hexschool.io/api/lucy104/products/all","").then(m=>{if(console.log("取得產品"),console.log(m.data),m.data.success){p.value=!1,t.productList=m.data.products,h.value=m.data.products;for(let n of t.productList)n.isInWishList=!1}})},g=()=>{I.push("/"),t.productList=Object.assign(h.value),console.log("hungry",t.productList),s.value=!1},o=c(!1),r=c({name:"",picture:"",email:"",tel:"",address:""});function u(){sessionStorage.getItem("sessionIsLogin")!==null&&(console.log("a"),o.value=!0);const n=sessionStorage.getItem("sessionGoogleInfo");n!==null&&(console.log("b"),r.value=JSON.parse(n))}Z(async()=>{u(),window.addEventListener("sessionUpdated",u),await S()}),T(()=>{window.removeEventListener("sessionUpdated",u)});const L=()=>{o.value=!1,r.value={name:"",picture:"",email:"",tel:"",address:""},sessionStorage.clear(),localStorage.clear(),t.myPiniaOrder=[],a.value=!1},N=()=>{s.value=!1,t.productList=[...h.value],l.value==""?t.productList=[...h.value]:(t.productList=[...h.value],t.productList=t.productList.filter(m=>m.title.includes(l.value)))};return(m,n)=>{const V=M("router-view");return d(),f(U,null,[o.value==!1?(d(),_(ae,{key:0})):y("",!0),e("nav",null,[k(v(F),{class:"icon hamburger",onClick:n[0]||(n[0]=w=>s.value=!s.value)}),e("p",{class:"md-title",onClick:g},"雲購物"),s.value==!0?(d(),f("div",{key:0,class:"md-backdrop",onClick:n[1]||(n[1]=w=>s.value=!1)})):y("",!0),e("ul",{class:G(["hamburger-menu",{"menu-flex":s.value}])},[e("li",null,[e("p",{class:"pc-title",onClick:n[2]||(n[2]=w=>v(I).push("/"))},"雲購物")]),e("li",null,[b(e("input",{type:"text","onUpdate:modelValue":n[3]||(n[3]=w=>l.value=w)},null,512),[[C,l.value]]),e("button",{type:"button",class:"searchBtn",onClick:N},[k(v(z),{style:{color:"white",width:"20px",height:"20px"}})])])],2),e("ul",null,[e("li",null,[k(v(H),{class:"icon",onClick:n[4]||(n[4]=w=>(v(I).push("/wishlist"),s.value=!1))})]),e("li",null,[k(v(R),{class:"icon",onClick:n[5]||(n[5]=w=>(v(I).push("/cart"),s.value=!1))})]),e("li",null,[r.value.picture!==""?(d(),f("img",{key:0,src:r.value.picture,class:"google-picture",alt:"",onClick:n[6]||(n[6]=w=>(a.value=!a.value,s.value=!1))},null,8,le)):y("",!0),r.value.picture===""?(d(),_(v(W),{key:1,class:"icon"})):y("",!0)])])]),a.value?(d(),f("div",ie,[e("p",null,B(r.value.name)+",您好",1),e("p",{onClick:n[7]||(n[7]=w=>(v(I).push("/myOrder"),a.value=!1))},"我的訂單"),e("p",{onClick:L},"登出")])):y("",!0),k(V)],64)}}}),we=O(re,[["__scopeId","data-v-c01ddd18"]]);export{we as default};
