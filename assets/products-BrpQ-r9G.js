import{c as g,o as c,a as e,d as h,r as i,h as D,F as $,b as k,u as C,w as v,v as f,_ as V,t as _,k as A,j as F,e as U,L as j,J as T}from"./main-BP-vnyao.js";import{a as G,C as P}from"./connect-DGni7-7n.js";import{L as E}from"./index-C2CMy6ry.js";import{_ as B}from"./lodash-QkuW62gm.js";function J(m,s){return c(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M5.47 5.47a.75.75 0 0 1 1.06 0L12 10.94l5.47-5.47a.75.75 0 1 1 1.06 1.06L13.06 12l5.47 5.47a.75.75 0 1 1-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 0 1-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 0 1 0-1.06Z","clip-rule":"evenodd"})])}const Z={class:"modal-container"},z={class:"modal"},H={class:"modal-head"},K={class:"modal-body"},Q={class:"img-space"},R=["src"],W={class:"main-space"},X={class:"flex"},Y={class:"calc-50"},ee={class:"w-50"},te={class:"flex"},le={class:"calc-50"},oe={class:"w-50"},ne={class:"btn-container"},ae=h({__name:"addProductModal",props:{isEdit:{type:Boolean,required:!0},closeModal:{type:Function,required:!0},singleProduct:{type:Object,default:()=>({})},getProducts:{type:Function,required:!0}},setup(m){const s=m,l=i({category:"",title:"",origin_price:0,price:0,description:"",unit:"",content:"",id:"",imageUrl:""});D(()=>{console.log("singleProduct",s.singleProduct),console.log(s.isEdit),s.isEdit==!0?(l.value=B.cloneDeep(s.singleProduct),console.log("a",l.value)):l.value={category:"",title:"",origin_price:0,price:0,description:"",unit:"",content:"",id:"",imageUrl:""}});const d=i(!1),y=async u=>{var n;d.value=!0;const t=(n=u.target.files)==null?void 0:n[0];if(t){const x=new FormData;x.append("file-to-upload",t);const M=G.create();M.defaults.headers["Content-Type"]="multipart/form-data";try{const b=await P("POST","https://vue-course-api.hexschool.io/api/lucy104/admin/upload",x);console.log("上傳圖片"),console.log(b.data),b.data.success&&(d.value=!1,l.value.imageUrl=b.data.imageUrl)}catch(b){console.error(b)}finally{delete M.defaults.headers["Content-Type"]}}},r=async()=>{if(s.isEdit){d.value=!0;const u={data:l.value};await P("PUT",`https://vue-course-api.hexschool.io/api/lucy104/admin/product/${l.value.id}`,u).then(t=>{console.log("更新產品"),console.log(t.data),t.data.success&&(d.value=!1,s.closeModal(),s.getProducts())})}else{d.value=!0;const u={data:l.value};await P("POST","https://vue-course-api.hexschool.io/api/lucy104/admin/product",u).then(t=>{console.log("建立產品"),console.log(t.data),t.data.success&&(d.value=!1,l.value={category:"",title:"",origin_price:0,price:0,description:"",unit:"",content:"",id:"",imageUrl:""},s.closeModal(),s.getProducts())})}};return(u,t)=>(c(),g($,null,[k(C(E),{active:d.value,"onUpdate:active":t[0]||(t[0]=n=>d.value=n),"can-cancel":!0,"is-full-page":!0},null,8,["active"]),e("div",Z,[e("div",z,[e("div",H,[t[12]||(t[12]=e("p",null,"建立自己的產品",-1)),k(C(J),{class:"x-icon",onClick:t[1]||(t[1]=n=>m.closeModal())})]),e("div",K,[e("div",Q,[t[13]||(t[13]=e("p",null,"輸入圖片網址:",-1)),v(e("input",{type:"text",placeholder:"請輸入圖片網址","onUpdate:modelValue":t[2]||(t[2]=n=>l.value.imageUrl=n)},null,512),[[f,l.value.imageUrl]]),t[14]||(t[14]=e("p",null,"或上傳圖片:",-1)),e("input",{type:"file",onChange:y},null,32),e("img",{src:l.value.imageUrl,alt:""},null,8,R)]),e("div",W,[t[19]||(t[19]=e("p",null,"標題",-1)),v(e("input",{type:"text",placeholder:"請輸入標題","onUpdate:modelValue":t[3]||(t[3]=n=>l.value.title=n)},null,512),[[f,l.value.title]]),e("div",X,[e("div",Y,[t[15]||(t[15]=e("p",null,"分類",-1)),v(e("input",{type:"text",placeholder:"請輸入分類","onUpdate:modelValue":t[4]||(t[4]=n=>l.value.category=n)},null,512),[[f,l.value.category]])]),e("div",ee,[t[16]||(t[16]=e("p",null,"單位",-1)),v(e("input",{type:"text",placeholder:"請輸入單位","onUpdate:modelValue":t[5]||(t[5]=n=>l.value.unit=n)},null,512),[[f,l.value.unit]])])]),e("div",te,[e("div",le,[t[17]||(t[17]=e("p",null,"原價",-1)),v(e("input",{type:"number",placeholder:"請輸入原價","onUpdate:modelValue":t[6]||(t[6]=n=>l.value.origin_price=n)},null,512),[[f,l.value.origin_price]])]),e("div",oe,[t[18]||(t[18]=e("p",null,"售價",-1)),v(e("input",{type:"number",placeholder:"請輸入售價","onUpdate:modelValue":t[7]||(t[7]=n=>l.value.price=n)},null,512),[[f,l.value.price]])])]),t[20]||(t[20]=e("p",null,"產品描述",-1)),v(e("textarea",{placeholder:"請輸入產品描述","onUpdate:modelValue":t[8]||(t[8]=n=>l.value.description=n)},null,512),[[f,l.value.description]]),t[21]||(t[21]=e("p",null,"說明內容",-1)),v(e("textarea",{placeholder:"請輸入說明內容","onUpdate:modelValue":t[9]||(t[9]=n=>l.value.content=n)},null,512),[[f,l.value.content]]),e("div",ne,[e("button",{type:"button",class:"cancel-btn",onClick:t[10]||(t[10]=n=>m.closeModal())},"取消"),e("button",{type:"button",class:"confirm-btn",onClick:t[11]||(t[11]=n=>r())},"確認")])])])])])],64))}}),se=V(ae,[["__scopeId","data-v-1c00bff8"]]),ue={class:"modal-container"},de={class:"modal"},ie={class:"modal-body"},re={class:"flex-end"},ce=h({__name:"deleteProductModal",props:{closeDeleteModal:{type:Function,required:!0},getProducts:{type:Function,required:!0},deleteId:{type:String,required:!0},products:{type:Array,default:()=>[]}},setup(m){const s=i(!1),l=m,d=i("");D(()=>{d.value=l.products.filter(r=>r.id===l.deleteId)[0].title});const y=async()=>{s.value=!0,await P("DELETE",`https://vue-course-api.hexschool.io/api/lucy104/admin/product/${l.deleteId}`,"").then(async r=>{console.log("刪除產品"),console.log(r.data),r.data.success&&(s.value=!1,await l.closeDeleteModal(),await l.getProducts())})};return(r,u)=>(c(),g($,null,[k(C(E),{active:s.value,"onUpdate:active":u[0]||(u[0]=t=>s.value=t),"can-cancel":!0,"is-full-page":!0},null,8,["active"]),e("div",ue,[e("div",de,[u[3]||(u[3]=e("div",{class:"modal-header"},[e("p",null,"刪除產品")],-1)),e("div",ie,[e("p",null,"是否要刪除 "+_(d.value)+"?",1),e("div",re,[e("button",{type:"button",class:"cancel-btn",onClick:u[1]||(u[1]=t=>m.closeDeleteModal())},"取消"),e("button",{type:"button",class:"delete-btn",onClick:u[2]||(u[2]=t=>y())},"刪除")])])])])],64))}}),pe=V(ce,[["__scopeId","data-v-6fb835c6"]]),ve={class:"filter-space"},ge={class:"flex"},fe={class:"flex"},me={class:"table-container"},ye=["onClick"],be=["onClick"],xe={class:"pagination-container"},_e={key:0,type:"button"},$e=["onClick"],Pe={key:1,type:"button"},Me=h({__name:"products",setup(m){const s=i(!1),l=i([]),d=i(!1),y=i({category:null,current_page:1,has_next:!0,has_pre:!1,total_pages:1}),r=async(p=1)=>{d.value=!0,await P("GET",`https://vue-course-api.hexschool.io/api/lucy104/admin/products?page=${p}`,"").then(o=>{console.log("取得產品"),console.log(o.data),o.data.success&&(d.value=!1,l.value=o.data.products,y.value=o.data.pagination)})};D(async()=>{await r()});const u=i(""),t=i(0),n=i(!1),x=i({}),M=()=>{s.value=!0,n.value=!1},b=p=>{n.value=!0,s.value=!0;const o=l.value.findIndex(a=>a.id==p);x.value=B.cloneDeep(l.value[o]),console.log(x.value)},w=i(!1),I=i(""),N=p=>{w.value=!0,I.value=p},L=A(()=>{const p=l.value.filter(o=>o.title.includes(u.value));switch(console.log(t.value),Number(t.value)){case 0:return[...p].sort((o,a)=>a.price-o.price);case 1:return[...p].sort((o,a)=>o.price-a.price);default:return console.log("default"),p}}),S=()=>{s.value=!1},O=()=>{w.value=!1};return(p,o)=>(c(),g($,null,[s.value?(c(),F(se,{key:0,closeModal:S,isEdit:n.value,singleProduct:x.value,getProducts:r},null,8,["isEdit","singleProduct"])):U("",!0),w.value?(c(),F(pe,{key:1,closeDeleteModal:O,getProducts:r,deleteId:I.value,products:L.value},null,8,["deleteId","products"])):U("",!0),e("div",null,[k(C(E),{active:d.value,"onUpdate:active":o[0]||(o[0]=a=>d.value=a),"can-cancel":!0,"is-full-page":!0},null,8,["active"]),o[7]||(o[7]=e("h1",{style:{"text-align":"center"}},"產品列表",-1)),e("div",ve,[e("div",ge,[o[3]||(o[3]=e("p",null,"產品名稱搜尋:",-1)),v(e("input",{type:"text",placeholder:"請輸入產品名稱","onUpdate:modelValue":o[1]||(o[1]=a=>u.value=a)},null,512),[[f,u.value]])]),e("div",fe,[o[5]||(o[5]=e("p",null,"排序:",-1)),v(e("select",{"onUpdate:modelValue":o[2]||(o[2]=a=>t.value=a)},o[4]||(o[4]=[e("option",{value:"0"},"售價由高至低",-1),e("option",{value:"1"},"售價由低至高",-1)]),512),[[j,t.value]])]),e("button",{type:"button",class:"add-btn",onClick:M},"新增產品")]),e("div",me,[e("table",null,[o[6]||(o[6]=e("thead",null,[e("tr",null,[e("th",null,"分類"),e("th",null,"產品名稱"),e("th",null,"原價"),e("th",null,"售價"),e("th",null,"編輯"),e("th",null,"刪除")])],-1)),e("tbody",null,[(c(!0),g($,null,T(L.value,a=>(c(),g("tr",{key:a.id},[e("td",null,_(a.category),1),e("td",null,_(a.title),1),e("td",null,_(a.origin_price),1),e("td",null,_(a.price),1),e("td",null,[e("button",{type:"button",class:"edit-btn",onClick:q=>b(a.id)},"編輯",8,ye)]),e("td",null,[e("button",{type:"button",class:"delete-btn",onClick:q=>N(a.id)},"刪除",8,be)])]))),128))])])]),e("div",xe,[y.value.has_pre?(c(),g("button",_e," 上一頁 ")):U("",!0),(c(!0),g($,null,T(y.value.total_pages,a=>(c(),g("button",{type:"button",onClick:q=>r(a)},_(a),9,$e))),256)),y.value.has_next?(c(),g("button",Pe,"下一頁")):U("",!0)])])],64))}}),he=V(Me,[["__scopeId","data-v-62b6339a"]]);export{he as default};
