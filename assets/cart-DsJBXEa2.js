import{d as w,r as n,h as C,E,c as v,o as c,b as k,a as l,u as D,F as m,J as S,t as u,w as r,v as d,g as I,_ as T}from"./index-BD2cTxBF.js";import{C as g}from"./connect-DGni7-7n.js";import{L as V}from"./index-DfgLizOp.js";import{u as B}from"./frontStage-C8x3WYE_.js";import{u as L}from"./signInStore-Be7Xrlf9.js";import{o as U,a as M}from"./indexedDB-C2533RPs.js";import{_ as N}from"./lodash-L6Y4raFB.js";const F={class:"container"},G={class:"table-container"},O=["onClick"],J={class:"details-container"},$=w({__name:"cart",setup(q){L(),B();const s=n(!1),i=n([]),y=n(0),p=n(0),f=async()=>{s.value=!0,await g("GET","https://vue-course-api.hexschool.io/api/lucy104/cart","").then(e=>{console.log("取得購物車列表"),console.log(e.data),e.data.success&&(s.value=!1,i.value=e.data.data.carts,y.value=e.data.data.total,p.value=e.data.data.final_total)})};n([]),n({});const o=n({name:"",picture:"",email:"",tel:"",address:""});C(()=>{E(async()=>{const e=sessionStorage.getItem("sessionGoogleInfo");e!==null&&(o.value=JSON.parse(e)),await f()})});const b=async()=>{const e=N.cloneDeep({id:Math.floor(Math.random()*1e3),products:i.value,user:o.value,isPaid:!1,finalTotal:p.value});console.log("letting go",e);let t;try{t=await U("orderDB",2),await M(t,"orders",e),await I.push("/myOrder"),console.log("Navigation successful!")}catch(a){console.error("Error storing data or navigating:",a)}},x=async e=>{s.value=!0,await g("DELETE",`https://vue-course-api.hexschool.io/api/lucy104/cart/${e}`,"").then(async t=>{console.log("移除購物車項目"),console.log(t.data),t.data.success&&(s.value=!1,await f())})};return(e,t)=>(c(),v(m,null,[k(D(V),{active:s.value,"onUpdate:active":t[0]||(t[0]=a=>s.value=a),"can-cancel":!0,"is-full-page":!0},null,8,["active"]),l("div",F,[l("div",G,[l("table",null,[t[9]||(t[9]=l("thead",null,[l("tr",null,[l("th"),l("th",null,"品名"),l("th",null,"數量"),l("th",null,"單價"),l("th",null,"總價")])],-1)),l("tbody",null,[(c(!0),v(m,null,S(i.value,a=>(c(),v("tr",{key:a.id},[l("td",null,[l("button",{type:"button",class:"delete-btn",onClick:A=>x(a.id)},"刪除",8,O)]),l("td",null,u(a.product.title),1),l("td",null,u(a.qty),1),l("td",null,u(a.product.price),1),l("td",null,u(a.final_total),1)]))),128)),l("tr",null,[t[5]||(t[5]=l("td",null,"總計:",-1)),t[6]||(t[6]=l("td",null,null,-1)),t[7]||(t[7]=l("td",null,null,-1)),t[8]||(t[8]=l("td",null,null,-1)),l("td",null,u(p.value)+"元",1)])])])]),l("div",J,[t[10]||(t[10]=l("p",{class:"order-details"},"請填寫: 訂單聯絡人資料",-1)),t[11]||(t[11]=l("p",{class:"details-label"},"Email :",-1)),r(l("input",{type:"email","onUpdate:modelValue":t[1]||(t[1]=a=>o.value.email=a),readonly:""},null,512),[[d,o.value.email]]),t[12]||(t[12]=l("p",{class:"details-label"},"收件人姓名 :",-1)),r(l("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=a=>o.value.name=a),readonly:""},null,512),[[d,o.value.name]]),t[13]||(t[13]=l("p",{class:"details-label"},"收件人電話 :",-1)),r(l("input",{type:"tel","onUpdate:modelValue":t[3]||(t[3]=a=>o.value.tel=a)},null,512),[[d,o.value.tel]]),t[14]||(t[14]=l("p",{class:"details-label"},"收件人地址 :",-1)),r(l("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=a=>o.value.address=a)},null,512),[[d,o.value.address]]),l("div",{class:"flex-end"},[l("button",{type:"button",onClick:b},"送出")])])])],64))}}),W=T($,[["__scopeId","data-v-2ade63f5"]]);export{W as default};
